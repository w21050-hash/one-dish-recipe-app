<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ä¸€å“ææ¡ˆå‹ãƒ¬ã‚·ãƒ”è¨˜éŒ²ã‚¢ãƒ—ãƒªï¼ˆæ¥½å¤©APIç‰ˆï¼‰</title>

  <style>
    body {
      font-family: sans-serif;
      background: #fafafa;
      padding: 15px;
    }
    h1, h2 {
      color: #333;
    }
    input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-top: 5px;
    }
    button {
      width: 100%;
      margin-top: 10px;
      padding: 10px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
    }
    .recipe-card {
      background: white;
      padding: 15px;
      margin-top: 10px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    img { width: 100%; border-radius: 8px; margin-top: 10px; }
  </style>

  <script type="module">

    // æ¥½å¤©API
    const APP_ID = "1009563489332319367";

    // æ—¥æœ¬èªé£Ÿæ â†’ ã‚«ãƒ†ã‚´ãƒªID ãƒãƒƒãƒ”ãƒ³ã‚°
    const ingredientMap = {
      "ã˜ã‚ƒãŒã„ã‚‚": "21-28",
      "ã«ã‚“ã˜ã‚“": "21-34",
      "ç‰ã­ã": "21-30",
      "ã‚­ãƒ£ãƒ™ãƒ„": "21-44",
      "ãƒ¬ã‚¿ã‚¹": "21-45",
      "ãƒ–ãƒ­ãƒƒã‚³ãƒªãƒ¼": "21-47",
      "ãªã™": "21-41",
      "ã»ã†ã‚Œã‚“è‰": "21-48",
      "ãƒˆãƒãƒˆ": "21-39",

      "é¶è‚‰": "10-11",
      "è±šè‚‰": "10-12",
      "ç‰›è‚‰": "10-10",

      "é®­": "11-57",
      "ã•ã°": "11-59",
      "é­š": "11-0",

      "åµ": "18-0",
      "è±†è…": "19-0",
      "ãã®ã“": "22-0",

      "ãƒ‘ã‚¹ã‚¿": "14-0",
      "ç±³": "15-0",
      "ãƒ‘ãƒ³": "16-0"
    };


    // æ¥½å¤©ãƒ¬ã‚·ãƒ”å–å¾—
    async function getRakutenRecipe(inputText) {

      const resultDiv = document.getElementById("recipeResult");
      resultDiv.innerHTML = "ãƒ¬ã‚·ãƒ”æ¤œç´¢ä¸­...";

      if (!inputText) {
        resultDiv.innerHTML = "é£Ÿæã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
        return;
      }

      // è¤‡æ•°èª â†’ æœ€åˆã®èªã®ã¿ä½¿ç”¨
      const ingredient = inputText.split(/[ ,ã€]/)[0];

      // ãƒãƒƒãƒ”ãƒ³ã‚°ã‹ã‚‰ã‚«ãƒ†ã‚´ãƒªIDå–å¾—
      const categoryId = ingredientMap[ingredient];

      if (!categoryId) {
        resultDiv.innerHTML = `${ingredient} ã«å¯¾å¿œã™ã‚‹ãƒ¬ã‚·ãƒ”ã‚«ãƒ†ã‚´ãƒªãŒã‚ã‚Šã¾ã›ã‚“ã€‚`;
        return;
      }

      try {
        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°å–å¾—
        const url = 
          `https://app.rakuten.co.jp/services/api/Recipe/CategoryRanking/20170426` +
          `?applicationId=${APP_ID}&categoryId=${categoryId}`;

        const res = await fetch(url);
        const data = await res.json();

        if (!data.result || data.result.length === 0) {
          resultDiv.innerHTML = "ã“ã®ã‚«ãƒ†ã‚´ãƒªã«ã¯ãƒ¬ã‚·ãƒ”ãŒã‚ã‚Šã¾ã›ã‚“ã€‚";
          return;
        }

        // ãƒ©ãƒ³ãƒ€ãƒ ãƒ¬ã‚·ãƒ”é¸æŠ
        const recipe = data.result[Math.floor(Math.random() * data.result.length)];

        resultDiv.innerHTML = `
          <div class="recipe-card">
            <h3>${recipe.recipeTitle}</h3>
            <img src="${recipe.foodImageUrl}">
            <p><a href="${recipe.recipeUrl}" target="_blank">æ¥½å¤©ãƒ¬ã‚·ãƒ”ã§è¦‹ã‚‹</a></p>
          </div>
        `;

      } catch (e) {
        resultDiv.innerHTML = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + e;
      }
    }

    window.getRakutenRecipe = getRakutenRecipe;

  </script>
</head>

<body>

  <h1>ä¸€å“ææ¡ˆå‹ãƒ¬ã‚·ãƒ”è¨˜éŒ²ã‚¢ãƒ—ãƒª ğŸ³</h1>

  <h2>é£Ÿæã‚’å…¥åŠ›</h2>
  <input id="ingredientInput" placeholder="ä¾‹ï¼šã˜ã‚ƒãŒã„ã‚‚ã€ã«ã‚“ã˜ã‚“">
  <button onclick="getRakutenRecipe(document.getElementById('ingredientInput').value)">
    ãƒ¬ã‚·ãƒ”ã‚’ææ¡ˆ
  </button>

  <h2>ãƒ¬ã‚·ãƒ”ææ¡ˆ</h2>
  <div id="recipeResult"></div>

</body>
</html>
